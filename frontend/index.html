<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manipulação de Autômatos JFF</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            width: 300px;
            margin: 0 auto;
        }
        .result {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Manipulação de Autômatos (.jff)</h1>

    <h2>Upload Automato (.jff)</h2>
    <form id="uploadForm">
        <input type="file" id="fileInput" name="file" accept=".jff" required>
        <button type="submit">Upload</button>
    </form>

    <div class="result">
        <h2>Resultado Upload</h2>
        <pre id="uploadResult">Nenhum arquivo enviado ainda.</pre>
    </div>

    <h2>Concatenar Autômatos (.jff)</h2>
    <form id="concatenacaoForm">
        <label for="file1">Arquivo JFF 1:</label>
        <input type="file" id="file1" name="file1" accept=".jff" required><br><br>

        <label for="file2">Arquivo JFF 2:</label>
        <input type="file" id="file2" name="file2" accept=".jff" required><br><br>

        <label for="outputPath">Caminho de Saída:</label>
        <input type="text" id="outputPath" name="outputPath" placeholder="output.jff" required><br><br>

        <button type="submit">Concatenar</button>
    </form>

    <div class="result">
        <h2>Resultado Concatenar</h2>
        <pre id="concatResult">Nenhum arquivo enviado ainda.</pre>
    </div>
</div>

<script>
    // Upload de Automato
    const uploadForm = document.getElementById('uploadForm');
    const uploadResult = document.getElementById('uploadResult');

    uploadForm.addEventListener('submit', function (e) {
        e.preventDefault();

        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];

        if (file) {
            const formData = new FormData();
            formData.append('file', file);

            fetch('http://localhost:8080/api/automato/upload', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    let result = 'Estados:\n';
                    data.estados.forEach(estado => {
                        result += `ID: ${estado.id}, Nome: ${estado.nome}, Inicial: ${estado.inicial}, Final: ${estado.final}\n`;
                    });

                    result += '\nTransições:\n';
                    data.transicoes.forEach(transicao => {
                        result += `De: ${transicao.origem.nome}, Para: ${transicao.destino.nome}, Símbolo: ${transicao.simbolo}\n`;
                    });

                    uploadResult.textContent = result;
                })
                .catch(error => {
                    uploadResult.textContent = 'Erro ao enviar o arquivo: ' + error.message;
                });
        }
    });

    // Concatenar Automatos
    const concatenacaoForm = document.getElementById('concatenacaoForm');
    const concatResult = document.getElementById('concatResult');

    concatenacaoForm.addEventListener('submit', function (e) {
        e.preventDefault();

        const fileInput1 = document.getElementById('file1');
        const fileInput2 = document.getElementById('file2');
        const outputPath = document.getElementById('outputPath').value;

        const file1 = fileInput1.files[0];
        const file2 = fileInput2.files[0];

        if (file1 && file2 && outputPath) {
            const formData = new FormData();
            formData.append('file1', file1);
            formData.append('file2', file2);
            formData.append('outputPath', outputPath);

            fetch('http://localhost:8080/api/automato/concatenacao', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    } else {
                        return response.text().then((text) => {
                            throw new Error(text);
                        });
                    }
                })
                .then(data => {
                    concatResult.textContent = 'Sucesso: ' + data;
                })
                .catch(error => {
                    concatResult.textContent = 'Erro ao enviar os arquivos: ' + error.message;
                });
        } else {
            concatResult.textContent = 'Por favor, selecione dois arquivos .jff e um caminho de saída.';
        }
    });
</script>
</body>
</html>
